{"componentChunkName":"component---src-templates-blog-post-tsx","path":"/blog/use-benchmark/","result":{"data":{"site":{"siteMetadata":{"title":"K.Iwata's BLOG"}},"markdownRemark":{"id":"91f631e6-0af5-54fd-8a7e-9b6a564b19c5","excerpt":"JavaScriptを使用していると、実現したい方法がいく通りが存在します。 少ない処理はあまり変わらないですが、多くのデータを使用するとなればパフォーマンスに大きく影響してきます。 そのパフォーマンスを確かめるためにBenchmark.js…","html":"<p>JavaScriptを使用していると、実現したい方法がいく通りが存在します。<br>\n少ない処理はあまり変わらないですが、多くのデータを使用するとなればパフォーマンスに大きく影響してきます。</p>\n<p>そのパフォーマンスを確かめるためにBenchmark.jsを使用してみます。</p>\n<p><a href=\"https://benchmarkjs.com/\">ドキュメントはこちらから。</a></p>\n<h2 id=\"インストール\">インストール</h2>\n<p>今回はディープコピーについて、３つの方法を比べてみましょう。</p>\n<p>まずは必要パッケージをインストールします。</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">npm</span> <span class=\"token function\">install</span> benchmark lodash</code></pre></div>\n<h2 id=\"コード\">コード</h2>\n<p>nodeを使用して実行します。<br>\nこの例ではオブジェクト配列をコピーする前提です。</p>\n\n        <div class=\"gatsby-code-title md-label\">\n          <span>index.js</span>\n        </div>\n       \n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> Benchmark <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'benchmark'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> clonedeep <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'lodash/cloneDeep'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> suite <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Benchmark<span class=\"token punctuation\">.</span>Suite</span>\n\n<span class=\"token keyword\">const</span> samples <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n  <span class=\"token punctuation\">{</span>\n    name<span class=\"token operator\">:</span> <span class=\"token string\">'test'</span><span class=\"token punctuation\">,</span>\n    age<span class=\"token operator\">:</span> <span class=\"token number\">26</span><span class=\"token punctuation\">,</span>\n    gender<span class=\"token operator\">:</span> <span class=\"token string\">'male'</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span>\n    name<span class=\"token operator\">:</span> <span class=\"token string\">'suite'</span><span class=\"token punctuation\">,</span>\n    age<span class=\"token operator\">:</span> <span class=\"token number\">30</span><span class=\"token punctuation\">,</span>\n    gender<span class=\"token operator\">:</span> <span class=\"token string\">'female'</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">]</span>\n\nsuite\n  <span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token string\">'json'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function-variable function\">fn</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> jsonDeep <span class=\"token operator\">=</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">parse</span><span class=\"token punctuation\">(</span><span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span>samples<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token string\">'map'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function-variable function\">fn</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> mapDeep <span class=\"token operator\">=</span> samples<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">sample</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token operator\">...</span>sample<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token string\">'lodash'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function-variable function\">fn</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> loDeep <span class=\"token operator\">=</span> <span class=\"token function\">clonedeep</span><span class=\"token punctuation\">(</span>samples<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'cycle'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">event</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token function\">String</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'complete'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Fastest is </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>suite<span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fastest'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token string\">'name'</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> async<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>addメソッドでテストを追加します。<br>\ncycleイベントで詳細を出力し、completeイベントでテストの最速を表示するようにしています。</p>\n<p>では結果はどうなんでしょうか。</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">json x <span class=\"token number\">339,283</span> ops/sec ±4.38% <span class=\"token punctuation\">(</span><span class=\"token number\">83</span> runs sampled<span class=\"token punctuation\">)</span>\nmap x <span class=\"token number\">15,391</span>,325 ops/sec ±3.14% <span class=\"token punctuation\">(</span><span class=\"token number\">79</span> runs sampled<span class=\"token punctuation\">)</span>\nlodash x <span class=\"token number\">532,430</span> ops/sec ±2.88% <span class=\"token punctuation\">(</span><span class=\"token number\">78</span> runs sampled<span class=\"token punctuation\">)</span>\nFastest is map</code></pre></div>\n<p>mapを使用した方法が一番早いですね。<br>\nといった具合に比較して結果を出力してくれます。</p>\n<h2 id=\"ちなみに\">ちなみに</h2>\n<p>単なるオブジェクトのコピーだったらmapは使用できません。<br>\nlodashとJSONを使用した方法の比較を載せておきます。</p>\n\n        <div class=\"gatsby-code-title md-label\">\n          <span>index.js</span>\n        </div>\n       \n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> obj <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  name<span class=\"token operator\">:</span> <span class=\"token string\">'Tom'</span><span class=\"token punctuation\">,</span>\n  male<span class=\"token operator\">:</span> <span class=\"token string\">'male'</span><span class=\"token punctuation\">,</span>\n  family<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    sister<span class=\"token operator\">:</span> <span class=\"token string\">'Henry'</span><span class=\"token punctuation\">,</span>\n    father<span class=\"token operator\">:</span> <span class=\"token string\">'Lee'</span><span class=\"token punctuation\">,</span>\n    mother<span class=\"token operator\">:</span> <span class=\"token string\">'Mary'</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\nsuite\n  <span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token string\">'json'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function-variable function\">fn</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">const</span> jsonDeep <span class=\"token operator\">=</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">parse</span><span class=\"token punctuation\">(</span><span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span>samples<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token string\">'lodash'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function-variable function\">fn</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">const</span> loDeep <span class=\"token operator\">=</span> <span class=\"token function\">clonedeep</span><span class=\"token punctuation\">(</span>samples<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token operator\">...</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">json x <span class=\"token number\">332,315</span> ops/sec ±8.37% <span class=\"token punctuation\">(</span><span class=\"token number\">78</span> runs sampled<span class=\"token punctuation\">)</span>\nlodash x <span class=\"token number\">673,675</span> ops/sec ±1.46% <span class=\"token punctuation\">(</span><span class=\"token number\">88</span> runs sampled<span class=\"token punctuation\">)</span>\nFastest is lodash</code></pre></div>\n<p>lodashの勝利。</p>","frontmatter":{"title":"どれが早いの？Benchmark.js使ってみようよ。","date":"2020-12-18","description":null,"hero":{"childImageSharp":{"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAMBAgX/xAAWAQEBAQAAAAAAAAAAAAAAAAABAAL/2gAMAwEAAhADEAAAAcoluxBYb//EABcQAAMBAAAAAAAAAAAAAAAAAAAQEQH/2gAIAQEAAQUCUMIv/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFhEBAQEAAAAAAAAAAAAAAAAAABES/9oACAECAQE/AYy//8QAFBABAAAAAAAAAAAAAAAAAAAAIP/aAAgBAQAGPwJf/8QAGBAAAwEBAAAAAAAAAAAAAAAAAAERMXH/2gAIAQEAAT8hWaicKGg0aIf/2gAMAwEAAgADAAAAEIc//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFhEAAwAAAAAAAAAAAAAAAAAAARBR/9oACAECAQE/EBSf/8QAHBABAAIDAAMAAAAAAAAAAAAAAQARMUFRYYGR/9oACAEBAAE/EKOA+SWdP3GzB9I6qhORVrcQKcn/2Q==","aspectRatio":1.5,"src":"/static/96673e1db1b9a0895627031971f9c2b6/9842e/javascript.jpg","srcSet":"/static/96673e1db1b9a0895627031971f9c2b6/07ab6/javascript.jpg 225w,\n/static/96673e1db1b9a0895627031971f9c2b6/32fd5/javascript.jpg 450w,\n/static/96673e1db1b9a0895627031971f9c2b6/9842e/javascript.jpg 900w","srcWebp":"/static/96673e1db1b9a0895627031971f9c2b6/210c1/javascript.webp","srcSetWebp":"/static/96673e1db1b9a0895627031971f9c2b6/975bf/javascript.webp 225w,\n/static/96673e1db1b9a0895627031971f9c2b6/b8a88/javascript.webp 450w,\n/static/96673e1db1b9a0895627031971f9c2b6/210c1/javascript.webp 900w","sizes":"(max-width: 900px) 100vw, 900px"},"sizes":{"src":"/static/96673e1db1b9a0895627031971f9c2b6/14b42/javascript.jpg"}}}},"tableOfContents":"<ul>\n<li><a href=\"#%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB\">インストール</a></li>\n<li><a href=\"#%E3%82%B3%E3%83%BC%E3%83%89\">コード</a></li>\n<li><a href=\"#%E3%81%A1%E3%81%AA%E3%81%BF%E3%81%AB\">ちなみに</a></li>\n</ul>"}},"pageContext":{"slug":"/use-benchmark/","previous":{"fields":{"slug":"/graphql-todo-app/"},"frontmatter":{"title":"GraphQLとReactでTODOアプリを作成する。","tags":["graphql","javascript","react"]}},"next":{"fields":{"slug":"/vue3-pagination/"},"frontmatter":{"title":"Vue3.0でページネーションを作成する","tags":["vue"]}}}},"staticQueryHashes":["1469311817","253180232"]}